<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.hyundai.mapper.QnAMapper">

	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type== 'T'.toString()">
							qtitle like '%' || #{keyword} || '%'
						</when>
						<when test="type== 'C'.toString()">
							qcontent like '%' || #{keyword} || '%'
						</when>
						<when test="type== 'W'.toString()">
							mid like '%' || #{keyword} || '%'
						</when>
					</choose> <!-- end choose -->
				</trim><!--end trim OR -->
			</foreach> <!--foreach -->
		</trim> <!--end trim pre... -->
	</sql>

	 <select id="getTotalCount" resultType="int">
	 	select count(*) from qna where <include refid="criteria"> </include> qid>0
	 </select>
 

	<select id="getList" resultType="com.hyundai.domain.QnAVO">
       select * from qna order by qid DESC
   </select> 
   
   <select id="getListWithPaging" resultType="com.hyundai.domain.QnAVO">
   <![CDATA[
   select *
       from(
	       select
		       	/*+ INDEX_DESC(qna qna_pk)*/
		       	rownum rn, qid, mid, qtitle, qcontent, qdate
	       		from qna
	       		where 
   ]]>
		 <trim prefix="(" suffix=") AND " prefixOverrides="OR">
		 	<foreach item="type" collection="typeArr">
		 		<trim prefix="OR">
		 			<choose>
		 				<when test="type== 'T'.toString()">
		 					qtitle like '%' ||  #{keyword} ||  '%' 				
		 				</when>
		 				<when test="type== 'C'.toString()">
		 					qcontent like '%' ||  #{keyword} ||  '%' 
		 				</when>
		 				<when test="type== 'W'.toString()">
		 					mid like '%' ||  #{keyword} ||  '%' 
		 				</when> 			
		 			</choose> <!-- end choose --> 
		 		</trim><!--end trim OR  -->
		 	</foreach> <!--foreach  -->
		 </trim> <!--end trim pre...  -->
  
  <![CDATA[
  rownum <= #{pageNum} * #{amount}
  )
where rn > ( #{pageNum} - 1 ) *  #{amount}  
  
  ]]>
 </select>
   
  
   <insert id="insert" statementType="CALLABLE">
   	{
   		CALL sp_qna_insert(
   			#{mid},
   			#{qtitle},
   			#{qcontent}
   		)
   	
   	}
   
   </insert>
   <select id="read" resultType="com.hyundai.domain.QnAVO">
   	select * from qna where qid=#{qid}
   
   </select>
   
   <delete id="delete" statementType="CALLABLE">
   {
   		CALL sp_qna_delete(#{qid})
   }
   </delete>
   
   <update id="update" statementType="CALLABLE">
   {
	   CALL sp_qna_update(
	   			#{qid},
	   			#{mid},
	   			#{qtitle},
	   			#{qcontent}
	   		)
   }
   </update>
   
</mapper>